<html>
<head>
<script type="text/javascript" src="scripts/util/Requests.js"></script>
<script type="text/javascript" src="scripts/lib/glMatrix-0.9.5.min.js"></script>

<script id="shader-fs" type="x-shader/x-fragment">
    #ifdef GL_ES
    precision highp float;
    #endif

    void main(void) {
        gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);
    }
</script>

<script id="shader-vs" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    void main(void) {
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
    }
</script>
<script type="text/javascript">
		 	var testlogger;
		 	DependencyManager.register("Arrays", 		"util/Arrays.js");
		 	DependencyManager.register("Events", 		"util/Events.js");
		 	DependencyManager.register("Logging", 		"util/Logging.js");
		 	DependencyManager.register("Requests", 		"util/Requests.js");
		 	DependencyManager.register("GL", 			"util/GL.js");
		 	DependencyManager.register("DateFormat", 	"lib/date.format.js");
		 	DependencyManager.register("Raphael", 		"lib/raphael-min.js");
		 	DependencyManager.register("glMatrix", 		"lib/glMatrix-0.9.5.min.js");
		 	DependencyManager.afterLoading(init);
		 	
		    var shaderProgram;

		    function initShaders() {
		    	shaderProgram = gl.initShaders(["shader-fs", "shader-vs"]);

		        shaderProgram.vertexPositionAttribute = gl.getAttribLocation(shaderProgram, "aVertexPosition");
		        gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute);

		        shaderProgram.pMatrixUniform = gl.getUniformLocation(shaderProgram, "uPMatrix");
		        shaderProgram.mvMatrixUniform = gl.getUniformLocation(shaderProgram, "uMVMatrix");
		    }
		    
		 	var gl;
		 	
			function init()
			{
				gl = GL.create("canvas", GL.TYPE_3D);
				
			    initShaders();
			    initBuffers();

			    gl.clearColor(0.0, 0.0, 0.0, 1.0);
			    gl.enable(gl.DEPTH_TEST);
			    gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);

			    drawScene();
			}


		    function drawScene() {
		        gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);
		        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

		        mat4.perspective(45, gl.viewportWidth / gl.viewportHeight, 0.1, 100.0, pMatrix);

		        mat4.identity(mvMatrix);

		        mat4.translate(mvMatrix, [-1.5, 0.0, -7.0]);
		        gl.bindBuffer(gl.ARRAY_BUFFER, triangleVertexPositionBuffer);
		        gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute, triangleVertexPositionBuffer.itemSize, gl.FLOAT, false, 0, 0);
		        setMatrixUniforms();
		        gl.drawArrays(gl.TRIANGLES, 0, triangleVertexPositionBuffer.numItems);


		        mat4.translate(mvMatrix, [3.0, 0.0, 0.0]);
		        gl.bindBuffer(gl.ARRAY_BUFFER, squareVertexPositionBuffer);
		        gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute, squareVertexPositionBuffer.itemSize, gl.FLOAT, false, 0, 0);
		        setMatrixUniforms();
		        gl.drawArrays(gl.TRIANGLE_STRIP, 0, squareVertexPositionBuffer.numItems);
		    }

		    var mvMatrix = mat4.create();
		    var pMatrix = mat4.create();

		    function setMatrixUniforms() {
		        gl.uniformMatrix4fv(shaderProgram.pMatrixUniform, false, pMatrix);
		        gl.uniformMatrix4fv(shaderProgram.mvMatrixUniform, false, mvMatrix);
		    }



		    var triangleVertexPositionBuffer;
		    var squareVertexPositionBuffer;
			
			function initBuffers()
			{
			    triangleVertexPositionBuffer = gl.createBuffer();
			    gl.bindBuffer(gl.ARRAY_BUFFER, triangleVertexPositionBuffer);
			    var vertices = [
				     0.0,  1.0,  0.0,
				    -1.0, -1.0,  0.0,
				     1.0, -1.0,  0.0
				];
			   	gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);
			   	triangleVertexPositionBuffer.itemSize = 3;
			    triangleVertexPositionBuffer.numItems = 3;
			    
			    squareVertexPositionBuffer = gl.createBuffer();
			    gl.bindBuffer(gl.ARRAY_BUFFER, squareVertexPositionBuffer);
			    vertices = [
			         1.0,  1.0,  0.0,
			        -1.0,  1.0,  0.0,
			         1.0, -1.0,  0.0,
			        -1.0, -1.0,  0.0
			    ];
			    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);
			    squareVertexPositionBuffer.itemSize = 3;
			    squareVertexPositionBuffer.numItems = 4;
			}
		</script>
</head>
<body onload="DependencyManager.registrationDone();">
	<canvas id="canvas" width="800" height="600"></canvas>
</body>
</html>